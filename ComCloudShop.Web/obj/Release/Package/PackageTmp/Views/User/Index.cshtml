
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model ComCloudShop.ViewModel.UserIndexViewModel

<div class="wrapper">
    <div class="headaccount">
        <div class="accountImg"><img src="@Model.url" alt=""></div>
        <h2>微信账号 @Model.username</h2>
        <p>现有积分：<span class="jifen"></span></p>
        <a class="entera">完善资料</a>
        <a href="~/User/Edit" class="enter"></a>
    </div>
    <div class="accountNav">
        <ul>
            <li><a href="~/Order/List?c=0">全部订单<i class="nav01"></i></a></li>
            <li><a href="~/Order/List?c=1">待付款<i class="nav02"></i></a></li>
            <li><a href="~/Order/List?c=2">配送中<i class="nav03"></i></a></li>
            <li><a href="~/Order/List?c=3">已完成<i class="nav04"></i></a></li>
        </ul>
    </div>
    <div class="accountInfo">
        <ul>
            <li><a href="~/Coupon/">我的优惠券<i class="enter"></i></a></li>
            <li><a href="~/Address/List?c=address">收货地址管理<i class="enter"></i></a></li>
        </ul>
    </div>
    <div class="accountSave">
        <span>共省了<label>@Model.number</label>元</span>
    </div>
</div>
<script type="text/javascript">
    $.ajax({
        async: false
    });
$(function(){
 var openids="@Model.openid";
 var phone="@Model.phone";
 var url = "http://wl.fgcare.com/wx/GetDotByOpenID.asp?id="+openids+"&phone="+phone;
        $.ajax({
            type: "get",
            url: url,
            dataType: "jsonp",
            jsonp: 'FGCallback',
            success: function (data) {
                alert(data)
            }
            ,jsonpCallback: "FGCallback",
            success : function(json){
                if(json.Code=="1"){
                    $(".jifen").text(json.IDot);
                    $.ajax({
                        async: false,
                        type: "get",
                        url: "/User/UpdateJF/?dot=" + json.IDot,
                        dataType: 'text',
                        success: function (data) {

                        }
                    });
				}
				else{
				   $(".jifen").text("0");
				}
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                $(".jifen").text("0");
            }
        });
})
</script>

